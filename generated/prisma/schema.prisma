generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model ai_insights {
  id               String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  content_id       String         @unique @db.Uuid
  summary          String
  hook             Json
  format           Json
  angle            Json
  idea_suggestions Json
  confidence       Float
  raw_analysis     Json
  created_at       DateTime       @default(now()) @db.Timestamptz(6)
  saved_contents   saved_contents @relation(fields: [content_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model collection_items {
  id             String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  content_id     String         @db.Uuid
  collection_id  String         @db.Uuid
  collections    collections    @relation(fields: [collection_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  saved_contents saved_contents @relation(fields: [content_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([content_id, collection_id])
}

model collections {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workspace_id     String             @db.Uuid
  name             String
  description      String
  created_by       String             @db.Uuid
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  collection_items collection_items[]
  users            users              @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  workspaces       workspaces         @relation(fields: [workspace_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model contents_tags {
  id             String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  content_id     String         @db.Uuid
  tag_id         String         @db.Uuid
  saved_contents saved_contents @relation(fields: [content_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tags           tags           @relation(fields: [tag_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([content_id, tag_id])
}

model notes {
  id             String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  content_id     String         @db.Uuid
  text           String
  created_at     DateTime       @default(now()) @db.Timestamptz(6)
  saved_contents saved_contents @relation(fields: [content_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model saved_contents {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workspace_id     String             @db.Uuid
  url              String
  source           String
  title            String?
  created_by       String             @db.Uuid
  thumbnail_url    String
  metadata         Json
  transcript       String?
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  ai_insights      ai_insights?
  collection_items collection_items[]
  contents_tags    contents_tags[]
  notes            notes[]
  users            users              @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  workspaces       workspaces         @relation(fields: [workspace_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model tags {
  id            String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workspace_id  String          @db.Uuid
  name          String
  type          String
  contents_tags contents_tags[]
  workspaces    workspaces      @relation(fields: [workspace_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([workspace_id, name])
}

model usage_logs {
  id           String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id      String     @db.Uuid
  workspace_id String     @db.Uuid
  tokens_used  BigInt
  created_at   DateTime   @default(now()) @db.Timestamptz(6)
  users        users      @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  workspaces   workspaces @relation(fields: [workspace_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model users {
  id                String              @id @db.Uuid
  email             String
  plan              user_plan           @default(free)
  created_at        DateTime            @default(now()) @db.Timestamptz(6)
  name              String              @db.VarChar
  collections       collections[]
  saved_contents    saved_contents[]
  usage_logs        usage_logs[]
  workspace_members workspace_members[]
  workspaces        workspaces[]
}

model workspace_members {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workspace_id String         @db.Uuid
  user_id      String         @db.Uuid
  role         workspace_role @default(viewer)
  created_at   DateTime       @default(now()) @db.Timestamptz(6)
  users        users          @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  workspaces   workspaces     @relation(fields: [workspace_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([workspace_id, user_id])
}

model workspaces {
  id                String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  owner_id          String              @db.Uuid
  name              String
  is_personal       Boolean             @default(false)
  created_at        DateTime            @default(now()) @db.Timestamptz(6)
  collections       collections[]
  saved_contents    saved_contents[]
  tags              tags[]
  usage_logs        usage_logs[]
  workspace_members workspace_members[]
  users             users               @relation(fields: [owner_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

enum user_plan {
  free
  pro
  team
}

enum workspace_role {
  owner
  editor
  viewer
}
